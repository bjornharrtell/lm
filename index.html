<!DOCTYPE html>
<html>
  <head>
    <title>Mapbox Vector Tiles</title>
    <meta charset="UTF-8">
    <meta name=viewport content="width=device-width, maximum-scale=1, user-scalable=no, initial-scale=1">
    <link rel="stylesheet" href="ol.css" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
    <script src="ol.js"></script>
    <style>
      html, body, .map {
        position: absolute;
        font: 11px Open Sans, Arial, Helvetica, sans serif;
        padding: 0;
        margin: 0;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
      }
      input[type=checkbox] {
        vertical-align: middle;
        position: relative;
        bottom: 1px;
      }
      label {
        position: relative;
        top: 6px;
        left: 30px;
      }
    </style>
  </head>
  <body>
    <div id="map" class="map"></div>
    <label><input type="checkbox" id="labels" checked />Texter</label>
    <label><input type="checkbox" id="oh" checked />Höjdkurvor</label>
    <script>
      var origin = [218128, 6126002]

      function tileUrlFunction(c) {
        return 'terrang/'+c[0]+'/'+c[1]+'/'+c[2]+'.pbf'
      }

      var source = new ol.source.VectorTile({
        attributions: '© Lantmäteriet',
        format: new ol.format.MVT(),
        tileGrid: new ol.tilegrid.TileGrid({
          origin: origin,
          resolutions: [4096, 2048, 1024, 512, 256, 128, 64, 32, 16]
        }),
        tilePixelRatio: 2,
        tileUrlFunction: tileUrlFunction
      })

      var styleFunctions = {
        by_riks: function(f, res) {
          return [
            new ol.style.Style({
              fill: new ol.style.Fill({
                color: '#000000'
              })
            })
          ]
        },
        tx_riks: function(f, res) {
          if (!document.getElementById('labels').checked) return []
          var kkod = f.get('kkod')
          // if (res > 32) return []
          if (kkod < 2 || kkod > 9) return []
          if (res > 16 && kkod < 8 || kkod > 9) return []
          var weight = kkod <= 8 ? 'normal' : 'bold'
          return [
            new ol.style.Style({
              text: new ol.style.Text({
                font: weight + ' 10px Open Sans, Arial, Helvetica, sans serif',
                text: f.get('text'),
                stroke: new ol.style.Stroke({
                  color: '#ffffff',
                  width: 3
                })
              }),
              zIndex: 1000
            })
          ]
        },
        oh_riks: function(f, res) {
          if (!document.getElementById('oh').checked) return []
          return [
            new ol.style.Style({
              stroke: new ol.style.Stroke({
                color: '#ff8800'
              })
            })
          ]
        },
        al_riks: function(f, res) {
          var kkod = f.get('kkod')
          if (kkod == 24 && res > 256) return []
          var widthMap = {
            21: 2,
            23: 1.5,
            24: 1
          }
          var dashMap = {
            21: [5, 5],
            23: [5, 5],
            24: [5, 5]
          }
          var colorMap = {
            21: '#000000',
            23: '#000000',
            24: '#888888'
          }
          return [
            new ol.style.Style({
              stroke: new ol.style.Stroke({
                color: colorMap[kkod],
                width: widthMap[kkod],
                lineDash: dashMap[kkod]
              })
            })
          ]
        },
        vl_riks: function(f, res) {
          var kkod = f.get('kkod')
          var kat = 0
          if ((kkod >= 5011 && kkod <= 5044) || kkod === 5811) kkod = 1
          if (kkod > 5811) kkod = 2       
          var widthMap = {
            0: 0.5,
            1: 2,
            2: 1
          }
          return [
            new ol.style.Style({
              stroke: new ol.style.Stroke({
                color: '#000000',
                width: widthMap[kkod]
              })
            })
          ]
        },
        my_riks: function(f, res) {
          if (res > 16) return []
          var kkod = f.get('kkod')
          var colorMap = {
            1: '#cce4fc',
            2: '#daebc5',
            4: '#fff1ba',
            5: '#ffffff',
            7: '#a1d054',
            9: '#cf26e1',
            10: '#4860eb',
            12: '#b30075',
            13: '#d67eac',
            14: '#eebed8',
            15: '#e2e3e4',
            16: '#ec7175',
            17: '#37e3be',
            18: '#e688ac',
            19: '#9cec7f',
            20: '#1b82e9'
          }
          return [
            new ol.style.Style({
              fill: new ol.style.Fill({
                color: colorMap[kkod]
              }),
              stroke: new ol.style.Stroke({
                color: colorMap[kkod]
              })
            })
          ]
        }
      }
      
      function style(f, res) {
        return styleFunctions[f.get('layer')](f, res)
      }
            
      var layer = new ol.layer.VectorTile({
        // renderBuffer: 32,
        source: source,
        style: style
      })

      var map = new ol.Map({
        layers: [ layer ],
        target: 'map',
        view: new ol.View({
          center: [568914, 6495224],
          resolutions: [4096, 2048, 1024, 512, 256, 128, 64, 32, 16],
          zoom: 8
        }),
        interactions: [
          // new ol.interaction.DragRotate(),
          new ol.interaction.DoubleClickZoom(),
          new ol.interaction.DragPan(),
          // new ol.interaction.PinchRotate(),
          new ol.interaction.PinchZoom(),
          new ol.interaction.KeyboardPan(),
          new ol.interaction.KeyboardZoom(),
          new ol.interaction.MouseWheelZoom(),
          new ol.interaction.DragZoom()
        ]
      })
      
      function onClick() {
        source.refresh()
      }
    
      document.getElementById('labels').addEventListener('click', onClick)
      document.getElementById('oh').addEventListener('click', onClick)
    
    </script>
  </body>
</html>
